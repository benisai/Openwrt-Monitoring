#!/bin/sh

if [ "$ACTION" = add ]; then (
        # check if the mac is in known devices list
        known_mac="/etc/config/knownmac.txt"
        grep -q "$MACADDR" "$known_mac"
        unknown_mac_addr=$?
        date=$(date '+%Y-%m-%d--%H:%M:%S')

                if [ "$1" == "add" ] && [ "$unknown_mac_addr" -ne 0 ]; then (
                echo "date=$date device=$HOSTNAME ip=$IPADDR mac=$MACADDR" > /tmp/100_new_device.out
                echo "$MACADDR $IPADDR $HOSTNAME" >> /etc/config/knownmac.txt
                fi
        )
fi



date=$(date '+%Y-%m-%d--%H:%M:%S')

if [ "$ACTION" = add ]; then
    (
        echo "date=$date device=$HOSTNAME ip=$IPADDR mac=$MACADDR" >> /tmp/new_device.out
    )
fi
